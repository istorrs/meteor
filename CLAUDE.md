# Meteor — Development Guidelines

## Clangd Compliance (Mandatory)

All C code in this project **must** pass clangd with zero errors and zero warnings.

- Before submitting any C code change, verify it produces no clangd diagnostics.
- The project uses a `.clangd` config at the repo root that replaces the cross-compiler
  with `clang` for static analysis (since the actual target is MIPS cross-compiled).
- `compile_commands.json` is generated by CMake (`CMAKE_EXPORT_COMPILE_COMMANDS ON`)
  and symlinked to the project root. After any CMake reconfigure, re-symlink if needed:
  ```bash
  ln -sf build-t31/compile_commands.json compile_commands.json
  ```
- Run `clangd-20 --check=src/<file>.c` from the project root to verify a file.

## Build System

- Cross-compilation targeting MIPS32 (Ingenic T31X / T20X) via thingino toolchain.
- Two platforms: `t31` (Wyze Cam V3) and `t20` (Wyze Cam V2).
- Build: `mkdir -p build-t31 && cd build-t31 && cmake -DCMAKE_TOOLCHAIN_FILE=../cmake/toolchain-t31.cmake .. && make`
- Deploy scripts in `scripts/` support `--all` and name-based camera targeting via `scripts/cameras.json`.

## Static Analysis (Mandatory)

All C code **must** pass three static analysis tools with zero findings:

1. **cppcheck** — general bugs, undefined behavior, buffer overflows
2. **clang-tidy** — CERT-C, bugprone, clang-analyzer checks (config in `.clang-tidy`)
3. **flawfinder** — security-specific CWE scanning

Run all three with: `scripts/analyze.sh`

Key rules:
- Always `(void)`-cast intentionally discarded return values (`fprintf`, `snprintf`, `signal`, `setvbuf`)
- Use `snprintf` instead of `strncpy` (guaranteed null-termination)
- Use `nanosleep` instead of `usleep` (POSIX.1-2008 compliance)
- C11 Annex K functions (`memset_s`, `fprintf_s`) are **not available** on musl — the
  `DeprecatedOrUnsafeBufferHandling` check is suppressed in `.clang-tidy`
- Install tools: `sudo apt install cppcheck clang-tidy-20 flawfinder`

## Code Style

- C99, kernel style (tabs for indentation).
- `-Wall -Wextra` with zero warnings.
- SDK headers (`imp/`, `sysutils/`) are third-party and not subject to our lint rules.
